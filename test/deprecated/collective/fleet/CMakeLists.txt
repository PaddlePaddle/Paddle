# This file is generated by ${PADDLE_ROOT}/tools/gen_ut_cmakelists.py.
# Please don't modify this file manually.
# If you need to change unittests in this file, please modify testslist.csv in the current directory
# and then run the command `python3 ${PADDLE_ROOT}/tools/gen_ut_cmakelists.py -f ${CURRENT_DIRECTORY}/testslist.csv`
set(LOCAL_ALL_ARCH ON)
set(LOCAL_ALL_PLAT ON)

if(LOCAL_ALL_ARCH AND (LINUX OR WIN32))
  py_test_modules(
    test_fleet_static_mp_layers MODULES test_fleet_static_mp_layers ENVS
    "http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python")
endif()

if(LOCAL_ALL_ARCH AND (LINUX OR WIN32))
  py_test_modules(
    test_fleet_fp16_allreduce_meta_optimizer_deprecated MODULES
    test_fleet_fp16_allreduce_meta_optimizer_deprecated ENVS
    "http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python")
endif()

if(LOCAL_ALL_ARCH AND (LINUX OR APPLE))
  py_test_modules(
    test_fleet_utils MODULES test_fleet_utils ENVS
    "http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python")
  set_tests_properties(test_fleet_utils PROPERTIES TIMEOUT "120" LABELS
                                                   "RUN_TYPE=DIST")
endif()

if(LOCAL_ALL_ARCH AND LOCAL_ALL_PLAT)
  py_test_modules(
    test_communicator_sync
    MODULES
    test_communicator_sync
    ENVS
    "FLAGS_communicator_send_queue_size=1;FLAGS_communicator_max_merge_var_num=1;http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python"
  )
endif()

if(LOCAL_ALL_ARCH AND (LINUX OR WIN32))
  py_test_modules(
    test_fleet_meta_optimizer_base_deprecated MODULES
    test_fleet_meta_optimizer_base_deprecated ENVS
    "http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python")
endif()

if((WITH_GPU) AND (LINUX))
  py_test_modules(
    test_dygraph_save_for_auto_infer_deprecated
    MODULES
    test_dygraph_save_for_auto_infer_deprecated
    ENVS
    "NVIDIA_TF32_OVERRIDE=0;FLAGS_new_executor_micro_batching=False;http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python"
  )
  set_tests_properties(test_dygraph_save_for_auto_infer_deprecated
                       PROPERTIES TIMEOUT "300" LABELS "RUN_TYPE=DIST")
endif()

if(LOCAL_ALL_ARCH AND LOCAL_ALL_PLAT)
  bash_test_modules(
    test_auto_parallel_parallelizer_deprecated
    START_BASH
    ../../legacy_test/dist_test.sh
    TIMEOUT
    "120"
    LABELS
    "RUN_TYPE=DIST"
    ENVS
    "PADDLE_DIST_UT_PORT=21264;http_proxy=;https_proxy=;PYTHONPATH=../..:${PADDLE_BINARY_DIR}/python"
  )
  set_tests_properties(test_auto_parallel_parallelizer_deprecated
                       PROPERTIES TIMEOUT "120")
endif()
