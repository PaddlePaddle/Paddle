if(NOT WITH_FLUID_ONLY)
  add_subdirectory(legacy/cuda)
  add_subdirectory(legacy/function)
  add_subdirectory(legacy/utils)
  add_subdirectory(legacy/math)
  add_subdirectory(legacy/gserver)
  add_subdirectory(legacy/parameter)

  if(MOBILE_INFERENCE)
    add_subdirectory(legacy/capi)
  else()
    add_subdirectory(legacy/pserver)
    add_subdirectory(legacy/trainer)
    add_subdirectory(scripts)

    if(WITH_C_API)
      add_subdirectory(legacy/capi)
    endif()

    if(WITH_SWIG_PY)
      add_subdirectory(legacy/api)
    endif()
  endif()
endif()

add_subdirectory(testing)
set(PYTHON_TESTS_DIR ${PADDLE_BINARY_DIR}/python/paddle/fluid/tests CACHE INTERNAL "python tests directory")
if(NOT MOBILE_INFERENCE AND NOT RPI AND NOT WITH_C_API)
  add_subdirectory(fluid)
endif()
