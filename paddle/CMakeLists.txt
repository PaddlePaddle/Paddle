if(NOT WITH_FLUID_ONLY)
  add_subdirectory(legacy/cuda)
  add_subdirectory(legacy/function)
  add_subdirectory(utils)
  add_subdirectory(legacy/math)
  add_subdirectory(legacy/gserver)
  add_subdirectory(legacy/parameter)

  if(MOBILE_INFERENCE)
    add_subdirectory(capi)
  else()
    add_subdirectory(legacy/pserver)
    add_subdirectory(trainer)
    add_subdirectory(scripts)

    if(WITH_C_API)
      add_subdirectory(capi)
    endif()

    if(WITH_SWIG_PY)
      add_subdirectory(api)
    endif()
  endif()
endif()

add_subdirectory(testing)
if(NOT MOBILE_INFERENCE AND NOT RPI AND NOT WITH_C_API)
  add_subdirectory(fluid)
endif()
