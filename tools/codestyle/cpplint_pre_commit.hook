#!/bin/bash
set -e

CPPLINT="tools/codestyle/cpplint.py"
SUM=0

# The trick to remove deleted files: https://stackoverflow.com/a/2413151
for file in $(git diff --cached --name-status | awk '$1 != "D" {print $2}'); do
    $CPPLINT $file
    SUM=$(expr ${SUM} + $?)
done

if [ ${SUM} -eq 0 ]; then
    exit 0
else
    exit 1
fi
