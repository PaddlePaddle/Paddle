file(GLOB TEST_OPS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "test_*.py")
string(REPLACE ".py" "" TEST_OPS "${TEST_OPS}")

foreach(src ${TEST_OPS})
  py_test(${src} SRCS ${src}.py)
endforeach()

add_subdirectory(unittests)
add_subdirectory(book)
set_tests_properties(test_sync_batch_norm_op PROPERTIES TIMEOUT 16)
set_tests_properties(test_cross_op PROPERTIES TIMEOUT 30)
set_tests_properties(test_parallel_dygraph_sync_batch_norm PROPERTIES TIMEOUT 25)
set_tests_properties(test_imperative_lod_tensor_to_selected_rows PROPERTIES TIMEOUT 41)
set_tests_properties(test_quant2_int8_mobilenetv1_mkldnn PROPERTIES TIMEOUT 14)
set_tests_properties(test_lstm_op PROPERTIES TIMEOUT 12)
set_tests_properties(test_imperative_star_gan_with_gradient_penalty PROPERTIES TIMEOUT 21)
set_tests_properties(test_warpctc_op PROPERTIES TIMEOUT 32)
set_tests_properties(test_bicubic_interp_op PROPERTIES TIMEOUT 30)
set_tests_properties(test_graph PROPERTIES TIMEOUT 16)
set_tests_properties(convert_model2dot_ernie PROPERTIES TIMEOUT 37)
set_tests_properties(test_deformable_conv_op PROPERTIES TIMEOUT 16)
set_tests_properties(test_collective_broadcast_api PROPERTIES TIMEOUT 28)
set_tests_properties(test_nearest_interp_op PROPERTIES TIMEOUT 39)
set_tests_properties(test_profiler PROPERTIES TIMEOUT 23)
set_tests_properties(test_analyzer_mobilenet_transpose PROPERTIES TIMEOUT 22)
set_tests_properties(test_inplace_softmax_with_cross_entropy PROPERTIES TIMEOUT 16)
set_tests_properties(test_quantization_pass PROPERTIES TIMEOUT 37)
set_tests_properties(test_cross_entropy2_op PROPERTIES TIMEOUT 34)
set_tests_properties(test_analyzer_resnet50 PROPERTIES TIMEOUT 62)
set_tests_properties(test_sequence_conv PROPERTIES TIMEOUT 37)
set_tests_properties(test_fetch_unmerged PROPERTIES TIMEOUT 17)
set_tests_properties(test_gru_unit_op PROPERTIES TIMEOUT 33)
set_tests_properties(test_activation_nn_grad PROPERTIES TIMEOUT 39)
set_tests_properties(test_recognize_digits PROPERTIES TIMEOUT 38)
set_tests_properties(test_empty_op PROPERTIES TIMEOUT 33)
set_tests_properties(test_quant2_int8_resnet50_channelwise_mkldnn PROPERTIES TIMEOUT 29)
set_tests_properties(test_parallel_executor_transformer PROPERTIES TIMEOUT 44)
set_tests_properties(test_elementwise_div_op PROPERTIES TIMEOUT 19)
set_tests_properties(test_beam_search_decoder PROPERTIES TIMEOUT 22)
set_tests_properties(selected_rows_test PROPERTIES TIMEOUT 46)
set_tests_properties(test_regularizer_api PROPERTIES TIMEOUT 101)
set_tests_properties(test_multiclass_nms_op PROPERTIES TIMEOUT 15)
set_tests_properties(test_ir_memory_optimize_nlp PROPERTIES TIMEOUT 56)
set_tests_properties(test_add_reader_dependency PROPERTIES TIMEOUT 31)
set_tests_properties(trt_mobilenet_test PROPERTIES TIMEOUT 30)
set_tests_properties(test_analyzer_ner PROPERTIES TIMEOUT 15)
set_tests_properties(test_bilateral_slice_op PROPERTIES TIMEOUT 17)
set_tests_properties(test_collective_allreduce_api PROPERTIES TIMEOUT 28)
set_tests_properties(trt_resnext_test PROPERTIES TIMEOUT 41)
set_tests_properties(test_buffer_shared_memory_reuse_pass PROPERTIES TIMEOUT 36)
set_tests_properties(test_fuse_relu_depthwise_conv_pass PROPERTIES TIMEOUT 33)
set_tests_properties(test_analyzer_int8_resnet50 PROPERTIES TIMEOUT 39)
set_tests_properties(test_analyzer_int8_mobilenet_ssd PROPERTIES TIMEOUT 22)
set_tests_properties(test_fleet_util PROPERTIES TIMEOUT 12)
set_tests_properties(test_imperative_transformer_sorted_gradient PROPERTIES TIMEOUT 33)
set_tests_properties(test_matmul_op PROPERTIES TIMEOUT 15)
set_tests_properties(test_mobile_net PROPERTIES TIMEOUT 29)
set_tests_properties(test_quant_int8_mobilenetv2_mkldnn PROPERTIES TIMEOUT 32)
set_tests_properties(test_concat_mkldnn_op PROPERTIES TIMEOUT 17)
set_tests_properties(test_analyzer_quant_performance_benchmark PROPERTIES TIMEOUT 37)
set_tests_properties(test_ir_memory_optimize_transformer PROPERTIES TIMEOUT 19)
set_tests_properties(trt_quant_int8_yolov3_r50_test PROPERTIES TIMEOUT 59)
set_tests_properties(test_analyzer_ernie PROPERTIES TIMEOUT 36)
set_tests_properties(test_nearest_interp_v2_op PROPERTIES TIMEOUT 39)
set_tests_properties(decorator_test PROPERTIES TIMEOUT 60)
set_tests_properties(test_trilinear_interp_op PROPERTIES TIMEOUT 56)
set_tests_properties(test_collective_allgather_api PROPERTIES TIMEOUT 28)
set_tests_properties(test_bicubic_interp_v2_op PROPERTIES TIMEOUT 41)
set_tests_properties(test_gather_op PROPERTIES TIMEOUT 19)
set_tests_properties(test_static_save_load PROPERTIES TIMEOUT 73)
set_tests_properties(test_fleet_launch PROPERTIES TIMEOUT 38)
set_tests_properties(test_dataset_cifar PROPERTIES TIMEOUT 35)
set_tests_properties(test_imperative_selected_rows_to_lod_tensor PROPERTIES TIMEOUT 47)
set_tests_properties(test_rnn_nets_static PROPERTIES TIMEOUT 18)
set_tests_properties(test_index_select_op PROPERTIES TIMEOUT 23)
set_tests_properties(test_pretrained_model PROPERTIES TIMEOUT 16)
set_tests_properties(test_analyzer_googlenet PROPERTIES TIMEOUT 26)
set_tests_properties(test_c_comm_init_op PROPERTIES TIMEOUT 14)
set_tests_properties(test_parallel_ssa_graph_inference_feed_partial_data PROPERTIES TIMEOUT 14)
set_tests_properties(lite_resnet50_test PROPERTIES TIMEOUT 14)
set_tests_properties(test_quant2_int8_resnet50_range_mkldnn PROPERTIES TIMEOUT 25)
set_tests_properties(test_model PROPERTIES TIMEOUT 35)
set_tests_properties(jit_kernel_test PROPERTIES TIMEOUT 25)
set_tests_properties(test_parallel_executor_crf PROPERTIES TIMEOUT 71)
set_tests_properties(test_imperative_save_load PROPERTIES TIMEOUT 28)
set_tests_properties(trt_resnet50_test PROPERTIES TIMEOUT 76)
set_tests_properties(test_text PROPERTIES TIMEOUT 40)
set_tests_properties(test_concat_op PROPERTIES TIMEOUT 32)
set_tests_properties(test_word2vec PROPERTIES TIMEOUT 18)
set_tests_properties(test_partial_eager_deletion_transformer PROPERTIES TIMEOUT 46)
set_tests_properties(test_post_training_quantization_mnist PROPERTIES TIMEOUT 26)
set_tests_properties(test_dataset_movie_reviews PROPERTIES TIMEOUT 17)
set_tests_properties(test_communicator_half_async PROPERTIES TIMEOUT 23)
set_tests_properties(test_parallel_executor_seresnext_with_reduce_gpu PROPERTIES TIMEOUT 30)
set_tests_properties(test_dropout_op PROPERTIES TIMEOUT 24)
set_tests_properties(test_image_classification PROPERTIES TIMEOUT 88)
set_tests_properties(test_parallel_executor_profiler PROPERTIES TIMEOUT 35)
set_tests_properties(test_argsort_op PROPERTIES TIMEOUT 19)
set_tests_properties(test_sequence_pool PROPERTIES TIMEOUT 20)
set_tests_properties(trt_cascade_rcnn_test PROPERTIES TIMEOUT 33)
set_tests_properties(test_seq2seq PROPERTIES TIMEOUT 22)
set_tests_properties(test_cycle_gan PROPERTIES TIMEOUT 14)
set_tests_properties(im2col_test PROPERTIES TIMEOUT 44)
set_tests_properties(test_layers PROPERTIES TIMEOUT 23)
set_tests_properties(test_gather_nd_op PROPERTIES TIMEOUT 72)
set_tests_properties(test_nn_grad PROPERTIES TIMEOUT 34)
set_tests_properties(test_elementwise_sub_op PROPERTIES TIMEOUT 15)
set_tests_properties(test_row_conv_op PROPERTIES TIMEOUT 23)
set_tests_properties(test_analyzer_small_dam PROPERTIES TIMEOUT 29)
set_tests_properties(test_parallel_executor_seresnext_with_fuse_all_reduce_gpu PROPERTIES TIMEOUT 22)
set_tests_properties(test_dataset_movielens PROPERTIES TIMEOUT 40)
set_tests_properties(test_elementwise_min_op PROPERTIES TIMEOUT 12)
set_tests_properties(test_nan_inf PROPERTIES TIMEOUT 15)
set_tests_properties(test_deformable_conv_v1_op PROPERTIES TIMEOUT 18)
set_tests_properties(test_image_classification_fp16 PROPERTIES TIMEOUT 35)
set_tests_properties(save_quant2_model_resnet50 PROPERTIES TIMEOUT 16)
set_tests_properties(test_parallel_executor_transformer_auto_growth PROPERTIES TIMEOUT 60)
set_tests_properties(test_py_reader_using_executor PROPERTIES TIMEOUT 15)
set_tests_properties(test_pipeline PROPERTIES TIMEOUT 59)
set_tests_properties(test_imperative_qat_channelwise PROPERTIES TIMEOUT 34)
set_tests_properties(test_elementwise_add_op PROPERTIES TIMEOUT 23)
set_tests_properties(test_trt_dynamic_shape_ernie PROPERTIES TIMEOUT 21)
set_tests_properties(test_weight_decay PROPERTIES TIMEOUT 56)
set_tests_properties(test_imperative_ptb_rnn_sorted_gradient PROPERTIES TIMEOUT 31)
set_tests_properties(test_transformer PROPERTIES TIMEOUT 41)
set_tests_properties(test_analyzer_int8_mobilenetv2 PROPERTIES TIMEOUT 25)
set_tests_properties(test_analyzer_int8_mobilenetv1 PROPERTIES TIMEOUT 16)
set_tests_properties(test_crop_tensor_op PROPERTIES TIMEOUT 21)
set_tests_properties(test_eager_deletion_lstm_net PROPERTIES TIMEOUT 38)
set_tests_properties(test_lac PROPERTIES TIMEOUT 27)
set_tests_properties(test_analyzer_transformer PROPERTIES TIMEOUT 90)
set_tests_properties(test_datasets PROPERTIES TIMEOUT 40)
set_tests_properties(test_parallel_executor_mnist PROPERTIES TIMEOUT 15)
set_tests_properties(test_reducescatter_api PROPERTIES TIMEOUT 17)
set_tests_properties(test_imperative_ptb_rnn PROPERTIES TIMEOUT 40)
set_tests_properties(test_broadcast PROPERTIES TIMEOUT 15)
set_tests_properties(test_imperative_save_load_v2 PROPERTIES TIMEOUT 35)
set_tests_properties(test_conv3d_transpose_part2_op PROPERTIES TIMEOUT 54)
set_tests_properties(test_prroi_pool_op PROPERTIES TIMEOUT 30)
set_tests_properties(test_analyzer_bert PROPERTIES TIMEOUT 25)
set_tests_properties(test_multiprocess_dataloader_iterable_dataset_static PROPERTIES TIMEOUT 16)
set_tests_properties(test_dataset_wmt PROPERTIES TIMEOUT 19)
set_tests_properties(test_weight_quantization_mobilenetv1 PROPERTIES TIMEOUT 12)
set_tests_properties(test_reducescatter PROPERTIES TIMEOUT 15)
set_tests_properties(test_lstm_cudnn_op PROPERTIES TIMEOUT 23)
set_tests_properties(test_vision_models PROPERTIES TIMEOUT 76)
set_tests_properties(test_stack_op PROPERTIES TIMEOUT 14)
set_tests_properties(test_bilinear_interp_v2_op PROPERTIES TIMEOUT 42)
set_tests_properties(test_sequence_concat PROPERTIES TIMEOUT 19)
set_tests_properties(test_fleet_checkpoint PROPERTIES TIMEOUT 55)
set_tests_properties(test_deformable_psroi_pooling PROPERTIES TIMEOUT 15)
set_tests_properties(test_trilinear_interp_v2_op PROPERTIES TIMEOUT 114)
set_tests_properties(test_collective_reduce_api PROPERTIES TIMEOUT 28)
set_tests_properties(test_imperative_static_runner_mnist PROPERTIES TIMEOUT 17)
set_tests_properties(test_masked_select_op PROPERTIES TIMEOUT 18)
set_tests_properties(test_sigmoid_cross_entropy_with_logits_op PROPERTIES TIMEOUT 16)
set_tests_properties(test_imperative_optimizer_v2 PROPERTIES TIMEOUT 31)
set_tests_properties(test_code_generator PROPERTIES TIMEOUT 23)
set_tests_properties(test_label_semantic_roles PROPERTIES TIMEOUT 35)
set_tests_properties(test_quant_int8_resnet50_mkldnn PROPERTIES TIMEOUT 43)
set_tests_properties(test_user_defined_quantization PROPERTIES TIMEOUT 31)
set_tests_properties(test_partial_sum_op PROPERTIES TIMEOUT 19)
set_tests_properties(test_cond PROPERTIES TIMEOUT 24)
set_tests_properties(test_space_to_depth_op PROPERTIES TIMEOUT 42)
set_tests_properties(test_collective_reduce PROPERTIES TIMEOUT 28)
set_tests_properties(test_dyn_rnn PROPERTIES TIMEOUT 28)
set_tests_properties(test_sgd_op PROPERTIES TIMEOUT 168)
set_tests_properties(test_parallel_executor_seresnext_base_gpu PROPERTIES TIMEOUT 23)
set_tests_properties(test_norm_nn_grad PROPERTIES TIMEOUT 12)
set_tests_properties(test_allreduce PROPERTIES TIMEOUT 16)
set_tests_properties(test_bert PROPERTIES TIMEOUT 14)
set_tests_properties(test_matrix_nms_op PROPERTIES TIMEOUT 16)
set_tests_properties(test_dataset_uci_housing PROPERTIES TIMEOUT 19)
set_tests_properties(test_machine_translation PROPERTIES TIMEOUT 27)
set_tests_properties(test_allgather PROPERTIES TIMEOUT 16)
set_tests_properties(test_generator_dataloader PROPERTIES TIMEOUT 26)
set_tests_properties(test_partial_concat_op PROPERTIES TIMEOUT 18)
set_tests_properties(test_fuse_optimizer_pass PROPERTIES TIMEOUT 23)
set_tests_properties(test_rnn_encoder_decoder PROPERTIES TIMEOUT 22)
set_tests_properties(test_launch PROPERTIES TIMEOUT 24)
set_tests_properties(test_collective_scatter_api PROPERTIES TIMEOUT 28)
set_tests_properties(test_softmax_with_cross_entropy_op PROPERTIES TIMEOUT 35)
set_tests_properties(test_reduce_op PROPERTIES TIMEOUT 28)
set_tests_properties(test_adam_optimizer_fp32_fp64 PROPERTIES TIMEOUT 16)
set_tests_properties(test_elementwise_nn_grad PROPERTIES TIMEOUT 40)
set_tests_properties(test_quant_int8_mobilenetv1_mkldnn PROPERTIES TIMEOUT 21)
set_tests_properties(test_basic_api_transformation PROPERTIES TIMEOUT 60)
set_tests_properties(test_trt_dynamic_shape_ernie_ser_deser PROPERTIES TIMEOUT 53)
set_tests_properties(test_dataset_imdb PROPERTIES TIMEOUT 98)
set_tests_properties(test_buffer_shared_memory_reuse_pass_and_fuse_optimization_op_pass PROPERTIES TIMEOUT 28)
set_tests_properties(test_multiprocess_reader_exception PROPERTIES TIMEOUT 20)
set_tests_properties(test_conv_nn_grad PROPERTIES TIMEOUT 50)
set_tests_properties(test_conv3d_op PROPERTIES TIMEOUT 67)
set_tests_properties(test_program_prune_backward PROPERTIES TIMEOUT 43)
set_tests_properties(test_group_norm_op PROPERTIES TIMEOUT 44)
set_tests_properties(test_resnet PROPERTIES TIMEOUT 32)
set_tests_properties(test_imperative_optimizer PROPERTIES TIMEOUT 31)
set_tests_properties(test_pool2d_op PROPERTIES TIMEOUT 24)
set_tests_properties(test_imperative_qat PROPERTIES TIMEOUT 35)
set_tests_properties(test_transpose_op PROPERTIES TIMEOUT 25)
set_tests_properties(test_eager_deletion_gru_net PROPERTIES TIMEOUT 30)
set_tests_properties(test_activation_op PROPERTIES TIMEOUT 26)
set_tests_properties(test_reinforcement_learning PROPERTIES TIMEOUT 9)
set_tests_properties(test_normal PROPERTIES TIMEOUT 40)
set_tests_properties(test_quant2_int8_ernie_mkldnn PROPERTIES TIMEOUT 57)
set_tests_properties(test_lstmp_op PROPERTIES TIMEOUT 35)
set_tests_properties(test_analyzer_mobilenet_depthwise_conv PROPERTIES TIMEOUT 25)
set_tests_properties(test_bilinear_interp_op PROPERTIES TIMEOUT 43)
set_tests_properties(test_decoupled_py_reader PROPERTIES TIMEOUT 25)
set_tests_properties(test_collective_barrier_api PROPERTIES TIMEOUT 27)
set_tests_properties(test_fuse_bn_act_pass PROPERTIES TIMEOUT 20)
set_tests_properties(test_quant_int8_googlenet_mkldnn PROPERTIES TIMEOUT 14)
set_tests_properties(test_conv2d_op PROPERTIES TIMEOUT 67)
set_tests_properties(test_weight_decay_extend PROPERTIES TIMEOUT 53)
set_tests_properties(rpc_server_test PROPERTIES TIMEOUT 31)
set_tests_properties(test_elementwise_mul_op PROPERTIES TIMEOUT 18)
set_tests_properties(test_cyclic_cifar_dataset PROPERTIES TIMEOUT 31)
set_tests_properties(test_fuse_all_reduce_pass PROPERTIES TIMEOUT 18)
set_tests_properties(test_dygraph_multi_forward PROPERTIES TIMEOUT 20)
set_tests_properties(test_quant2_int8_resnet50_mkldnn PROPERTIES TIMEOUT 34)
set_tests_properties(test_norm_op PROPERTIES TIMEOUT 19)
if(NOT APPLE AND NOT WIN32)
  add_subdirectory(custom_op)
endif()
