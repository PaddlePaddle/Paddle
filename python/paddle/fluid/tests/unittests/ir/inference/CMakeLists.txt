if (WITH_GPU AND TENSORRT_FOUND)
  file(GLOB TEST_INFERENCE_IR_PASSES RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "test_*.py")

  file(GLOB TEST_MKLDNN_OPS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "test_mkldnn_*.py")
  foreach(TEST_MKLDNN_OP ${TEST_MKLDNN_OPS})
    list(REMOVE_ITEM TEST_INFERENCE_IR_PASSES ${TEST_MKLDNN_OP})
  endforeach()
  if(WITH_MKLDNN)
    foreach(target ${TEST_MKLDNN_OPS})
      py_test_modules(${target} MODULES ${target})
      set_tests_properties(${target} PROPERTIES TIMEOUT 300)
    endforeach()
  endif()

  string(REPLACE ".py" "" TEST_INFERENCE_IR_PASSES "${TEST_INFERENCE_IR_PASSES}")
  foreach(target ${TEST_INFERENCE_IR_PASSES})
    py_test_modules(${target} MODULES ${target})
    set_tests_properties(${target} PROPERTIES TIMEOUT 300)
  endforeach()

  if(WITH_NV_JETSON)
    set_tests_properties(test_trt_pool_op PROPERTIES ENVIRONMENT FLAGS_fraction_of_gpu_memory_to_use=0.1 TIMEOUT 450)
    set_tests_properties(test_trt_pool3d_op PROPERTIES ENVIRONMENT FLAGS_fraction_of_gpu_memory_to_use=0.1 TIMEOUT 450)
  else()
    set_tests_properties(test_trt_pool_op PROPERTIES ENVIRONMENT FLAGS_fraction_of_gpu_memory_to_use=0.1 TIMEOUT 45)
    set_tests_properties(test_trt_pool3d_op PROPERTIES ENVIRONMENT FLAGS_fraction_of_gpu_memory_to_use=0.1 TIMEOUT 45)
  endif()
endif()
